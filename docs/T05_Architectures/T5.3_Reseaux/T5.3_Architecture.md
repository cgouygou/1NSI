# T5.3 Architecture d'un réseau

!!! abstract "Notion de réseau"
    - En général, un **réseau** est un ensemble de *nœuds* reliés entre eux par des *liens*.
    - Un **réseau informatique** est un réseau dont les nœuds sont des équipements informatiques reliés par des liens de différente nature: câbles, fibre optique, liaisons satellites, ondes radio, ...).
    - Une **interface** est le point de raccordement entre un lien et un nœud: elle peut être matérielle (carte réseau) ou logicielle.
    - Un **protocole** est un ensemble de règles permettant d'établir, de mener et de terminer une communication entre deux équipements du réseau.

Dans ce cours, nous allons simuler un réseau local avec le logiciel [Filius](https://www.lernsoftware-filius.de/Herunterladen){:target="_blank"} installé sur les VM du lycée.

## 5.3.1 Un premier réseau

!!! example "Partie 1: Construction d'un réseau"
    1. Construire le sous-réseau ci-dessous, en cochant "Utiliser l'adresse IP comme nom".

        ![](../images/filius0.png){: .center} 

        - **Adresse MAC** : Chaque ordinateur sur le réseau dispose d'une adresse MAC, qui est une valeur unique attribuée à sa carte réseau (Ethernet, Wifi, 4G, 5G, ...) lors de sa fabrication en usine.

            Cette adresse est codée sur 48 bits, présentés sous la forme de 6 octets en hexadécimal, ici `1F:5E:60:F0:15:23`.

            Les trois premiers octets correspondent au code du fabricant. Un site comme [https://www.macvendorlookup.com/](https://www.macvendorlookup.com/){:target="_blank"}  vous permet de retrouver le fabricant d'une adresse MAC quelconque.

        - **Adresse IP**: Une machine possède en général une adresse IP par interface et contrairement à l'adresse MAC, elle peut être modifiée lors du paramétrage du réseau.. Nous utiliserons la version IPv4 (sur 4 octets) bien que cette version est peu à peu remplacée par la version IPv6.

    2. Passer en mode simulation (triangle vert), puis cliquer sur l'ordinateur `192.168.0.1` et installer le logiciel "Ligne de commande".
    3. Réaliser un `ping` de la machine `192.168.0.1` vers la machine `192.168.0.3` en tapant `ping 192.168.0.3` en ligne de commande.

!!! info "Rôle du switch"
    Le rôle d'un switch est de distribuer un message au bon destinataire, en analysant la trame reçue. Lors d'un branchement d'un nouvel ordinateur sur le switch, celui-ci récupère son adresse MAC, ce qui lui permet de **trier** les messages.

    ![](../images/switch.png){: .center} 

!!! example "Partie 2: un deuxième réseau"
    1. Renommer le switch en "SwitchA" et créer un deuxième réseau de trois machines d'adresses IP `192.168.1.1`, `192.168.1.2` et `192.168.1.3` avec un "SwitchB".

    2. Tester un `ping` de `192.168.0.1` vers `192.168.1.2`.

    3. Renommer la machine `192.168.1.2` en `192.168.0.16` et retenter le `ping`. Que se passe-t-il?

## 5.3.2 Masque de sous-réseau

Lorsqu'une machine A veut envoyer un message à une machine B, elle doit déterminer si cette machine :

- appartient au même sous-réseau : auquel cas le message est envoyé directement via un ou plusieurs switchs.
- n'appartient pas au même sous-réseau : auquel cas le message doit d'abord transiter par un routeur (voir plus loin).

La notion de sous-réseau n'est pas topologique («il suffit de relier les ordinateurs entre eux») mais obéit à des règles numériques.

C'est le masque de sous-réseau (tout simplement "Masque" dans Filius, netmask en anglais) qui permet de déterminer quelles adresses font partie d'un même réseau.

!!! abstract "Adresse IP et masque de sous-réseau"
    Une adresse IP comporte deux parties: 

    - l'adresse du réseau : les *k* premiers bits;
    - l'adresse de l'hôte : les *32-k* derniers bits.

    La valeur de *k* est variable pour chaque réseau, elle acompagne donc généralement les adresses et se nomme **masque de sous-réseau**.

    Un masque de sous-réseau est souvent représenté comme une adresse IPv4 par 4 octets, et est constitué d'une suite de *k* `1` suivie d'une suite de `0`.

    === "Exemple 1"
        - Le masque par défaut de Filius est `255.255.255.0`, qui s'écrit en binaire : `11111111.11111111.11111111.00000000`.

        - La valeur de *k* est donc 24. On note donc aussi (notation CIDR) l'adresse IP : `192.168.0.1 / 24`.

        - Dans cette configuration, 256 machines peuvent donc appartenir au même sous-réseau (ce n'est pas tout à fait le cas car des adresses finissant par 0 ou par 255 sont réservées).

        - Deux machines appartiennent au même sous-réseau si elles **partagent les 3 premiers nombres (octets) de leur adresse IP**, c'est à dire les 24 premiers bits.

    === "Exemple 2"
        - Une autre valeur de masque peut être `255.255.248.0`, qui s'écrit en binaire : `11111111.11111111.11111000.00000000`.

        - La valeur de *k* est donc 21. On note donc aussi (notation CIDR) l'adresse IP : `192.168.0.1 / 21`.

        - Deux machines appartiennent au même sous-réseau si elles **partagent les 21 premiers bits de leur adresse IP**.

        - Combien de machines peuvent appartenir à ce même sous-réseau ?

!!! note "Appartenance à un même sous-réseau"
    Pour que deux machines appartiennent à un même sous-réseau, il faut donc qu'elles partagent un même nombre de bits, donnés par le masque de sous-réseau.

    L'opération qui permet de le déterminer est le `&` (et) logique, bit à bit.

    === "Exemple"
        Considérons trois machines A, B, C d'IP respectives ```192.168.129.10```, ```192.168.135.200``` et ```192.168.145.1```, configurées avec un masque de sous-réseau égal à ```255.255.248.0```.  

        |        | machine A      | machine B       | machine C     |
        |--------|----------------|-----------------|---------------|
        | IP     | 192.168.129.10 | 192.168.135.200 | 192.168.145.1 |
        | M      | 255.255.248.0  |  255.255.248.0  | 255.255.248.0 |
        | IP & M |   |  | |

    === "Correction"

        |        | machine A      | machine B       | machine C     |
        |--------|----------------|-----------------|---------------|
        | IP     | 192.168.129.10 | 192.168.135.200 | 192.168.145.1 |
        | M      | 255.255.248.0  |  255.255.248.0  | 255.255.248.0 |
        | IP & M | 192.168.128.0  |  192.168.128.0  | 192.168.144.0 |

        Les machines A et B font partie du même sous-réseau d'adresse `192.168.126.0`, mais pas la machine C.

<!-- ## 5.3.3 Utilisation et rôle du routeur -->

